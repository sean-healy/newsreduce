\section{Ranking\label{rank}}
\paragraph{A definition of \pr{}}
\pr{} \cite{page1999} is explained in simple terms in Section
\ref{goog}, but a more specific specification should also be outlined.
The implementation of \pr{} used by \nr{} treats webpages as nodes $p$ in
a graph, $p_i \in P$, $1 \le i \le |P|$, $i \in \mathbb{N}$.  Links from one page to another
are represented as directed edges between nodes in that graph,
$l_{i,j} \in G$, $1 \le i, j \le |P|$, $i, j \in \mathbb{N}$, $G \subseteq P \times P$.  
It is convenient to represent the link structure with two function $B$
and $F$, such that $B(j) = \{i~|~l_{i, j} \in G\}$, and
$F(i) = \{j~|~l_{i, j} \in G\}$.
In English, $B$ returns
the other webpages that link to a webpage (otherwise known as its
{\it backlinks}: indexes to the pages that
link to the webpage at index $i$).  $F$ returns the {\it forward links},
the links on a webpage.  This corresponds more closely to the general
idea of a `link' on the web.  A node cannot link to itself.  {\tt HTML}
files are pre-processed to ensure the such self-referential links don't
arise as input to the algorithm.

The implementation of \pr{} converges at some stage, leaving the final rankings of the
webpages stored in memory.  But before then,
the {\it running estimates} of the webpage rankings can be defined with the
binary function $R$.  The two arguments to R are: the webpage index $i$,
and the stage in the algorithm $t$, $t \ge 1$, $t \in \mathbb{N}$.  A {\it stage} represents one
cycle through the algorithm's central loop (Algorithm \ref{pr-algo}, line
\ref{loop}). Finally, \pr{} can be defined recursively:
\begin{align}
    R(i, t) = 
    \begin{cases}
        \frac{1}{|P|}, & t = 1\\
        \sum_{j \in B(i)} \frac{R(j, t - 1)}{|L(j)|}, & t \ne 1
    \end{cases}
\end{align}
\begin{algorithm}
\end{algorithm}
\begin{algorithm}
    \caption{Simplified \pr{} algorithm}\label{pr-algo}
    \begin{algorithmic}[1]
    \Require $T$, an error threshold, needed to halt \pr{}.
    \Require A set, $webpages$, where each element ($webpage$) has a
        property, $links$.  This returns a set of other webpages linked on
        the $webpage$.
        
        Each $webpage$ also represents an index, so it can
        be used to address the memory location of a $webpage$'s rank.

    \ForEach{$webpage \in webpages$}
    \Comment Initializing variables
        \State $previousRanks[webpage] \gets \frac{1}{|webpages|}$
    \EndFor
    \State $error \gets \infty$\;
    \While{$error > T$}\label{loop}
        \ForEach{$webpage \in webpages$}
            \State $nextRanks[webpage] \gets 0$
        \EndFor
        \ForEach{$webpage \in webpages$}
            \If{$|webpage.links|> 0$}
                \State $previousRankPiece \gets \frac{previousRanks[webpage]}{|webpage.links|}$
                \ForEach{$link \in webpage.links$}
                    \State $nextRanks[link] \gets nextRanks[link] + previousRankPiece$
                \EndFor
            \EndIf
        \EndFor
        \State $error \gets variance(previousRanks, nextRanks)$
        \State $tmp \gets nextRanks$
        \Comment Swapping $nextRanks$ and $previousRanks$
        \State $previousRanks \gets nextRanks$
        \State $nextRanks \gets tmp$
    \EndWhile
    \State $finalRanks \gets previousRanks$
    \end{algorithmic}
\end{algorithm}
Algorithm \ref{pr-algo} is the naive implementation, and in real world
scenarios it would be open to manipulation through rank sinks.
As mentioned in Section \ref{ir}, one solution was found through a finite
set of {\it escape} links, or {\it sources of rank} \cite{page1999}.
These links are chosen purposefully in various invocations of \pr{},
in order to produce geographically sensitive rankings.  Recalling that
\nr{} is currently designed to work for English language regions, some
example escape links are presented in Figure \ref{escape}.  To simplify
things, only 6 English-speaking countries are currently supported.  These
countries were chosen by population size.

In reality, many escape links are used per region, and
these links are chosen based on a combination of factors: The ccTLD
(e.g. {\tt .co.nz}),
the presence of substrings resembling the region name within the
hostname (e.g. {\tt \underline{irish}times.com}), and bayesian
classification applied to the weighted lexicon of words appearing in
crawls of the various domains.

\begin{figure}
    \centering
    \begin{tabular}{l|l}
        Region & \pr{} escape links\\
        \hline
        AU & \url{www.news.com.au}, \url{www.theaustralian.com.au}\\
        IE & \url{www.irishtimes.com}, \url{www.independent.ie}\\
        NZ & \url{www.nzherald.co.nz}, \url{www.stuff.co.nz}\\
        UK & \url{www.theguardian.com}, \url{www.dailymail.co.uk}\\
        US & \url{www.nytimes.com}, \url{www.wsj.com}\\
        JM & \href{http://jamaica-gleaner.com}{\url{jamaica-gleaner.com}},\url{www.loopjamaica.com}
    \end{tabular}
    \caption{\pr{} escape links by ISO-3166-2 country code.\label{escape}}
\end{figure}

\begin{algorithm}
\end{algorithm}
\begin{algorithm}
    \caption{\pr{} algorithm, with measures against rank sinks}\label{pr-algo-full}
    \begin{algorithmic}[1]
    \Require $T$, the error threshold from Algorithm \ref{pr-algo}.
    \Require The set $webpages$ from Algorithm \ref{pr-algo}.
    \Require $escapeWebpages$, a set of webpages
        useful for dealing with rank sinks.
    \ForEach{$webpage \in webpages$}
    \Comment Initializing variables
        \State $previousRanks[webpage] \gets \frac{1}{|webpages|}$
    \EndFor
    \State $error \gets \infty$\;
    \While{$error > T$}\label{loop}
        \ForEach{$webpage \in webpages$}
            \State $nextRanks[webpage] \gets 0$
        \EndFor
        \State $redistribute \gets 0$
        \State $redistributeRatio \gets 0$
        \State $decayRate \gets \frac{1}{2 \times 85}$
        \Comment Set with the expected iterations (in this case $\approx 85$).
        \ForEach{$webpage \in webpages$}
            \State $previousRank \gets previousRanks[webpage]$
            \If{$|webpage.links|> 0$}
                \State $rankPiece \gets \frac{previousRank \times (1 - redistributeRatio)}{|webpage.links|}$
                \ForEach{$link \in webpage.links$}
                    \State $nextRanks[link] \gets nextRanks[link] + rankPiece$
                \EndFor
                \State $redistribute \gets redistribute + previousRank \times redistributeRatio$
            \Else
                \State $redistribute \gets redistribute + previousRanks[webpage]$
            \EndIf
        \EndFor
        \ForEach{$webpage \in escapeWebpages$}
            \State $nextRanks[webpage] \gets nextRanks[webpage] + \frac{redistribute}{|escapeWebpages|}$
        \EndFor
        \State $error \gets variance(previousRanks, nextRanks)$
        \State $tmp \gets nextRanks$
        \Comment Swap $nextRanks$ and $previousRanks$
        \State $nextRanks \gets previousRanks$
        \State $previousRanks \gets tmp$
        \State $redistributeRatio \gets redistributeRatio + decayRate$
    \EndWhile
    \State $finalRanks \gets previousRanks$
    \end{algorithmic}
\end{algorithm}

Algorithm \ref{pr-algo-full} is a modified version of \pr{} (Algorithm
\ref{pr-algo}), aiming to tackle rank sinks, while also implementing
personalised ranking.  The argument $escapeWebpages$ is filled with
a set of webpages that may be of particular relevance to a geographic
region.